# 计算机网络复习
## Chap1引言
### 1.1 使用计算机网络
* 网络的商业应用：用户-服务器模型
* 家庭应用：P2P对等通信各种网络设备通过电缆等连接到internet
* 移动用户：通过移动设备进行语音和文本通信
* 社会问题：

### 1.2 网络硬件
* 分类的两大因素：**技术和规模**
* **按传输技术分类：点-点式网络、广播式网络**
  * 点对点：每条物理线路连接一对计算机，只有一个发送方和接收方
  * 广播：多台计算机共享一条通信信道。两个以上节点同时发送会冲突。
* **规模分类：个域网、局域网、城域网、广域网、互联网**
  * 广域网：远程网，跨越一个很大地理范围，包含大量的机器称为主机。
  * 互联网：一组相互连接起来的网络。

### 1.3 网络软件
* 协议层次结构
* 协议：同一层对等实体间交换的信息或分组的格式及含义的一组规则
  * 每对相邻层之间的是接口，接口定义了下层向上层提供哪些原语操作和服务。
  * 分层的好处：
    1. 使每层的设计简单化
    2. 各层独立
    3. 灵活性好
  * 两种接口：上下层之间的服务接口、对等实体之间交换的信息的对等实体接口。
* 服务原语：用户进程通过原语操作来访问该服务。

### 1.4 参考模型
* OSI(Open System Interconnection)模型
  * 物理层、数据链路层、网络层、传输层、会话层、表示层、应用层
  * 数据链路层：在物理线路上提供无差错的数据传输帧。
  * 网络层：控制通信子网提供源点到目的点的数据传输分组。选择路由和控制拥塞。
  * 传输层：提供端到端的数据传送服务。
  * 会话层：允许不同机器上的用户建立会话关系。
* TCP/IP协议
  * 主机至网络层、互联网层、传输层、应用层。
    * 互联网层：控制通信子网提供源点到目的点的IP分组传送。使用IP地址来寻址和传输数据。本质上无连接的传输。
    * 传输层：端到端的数据传输服务：TCP/UDP
    * 应用层：提供各种Internet管理和应用服务功能。

### 1.6 网络标准化组织
* ITU（国际电信联盟）：主要用于国与国之间的互联，每个国家内部可能有自己的标准
* ISO（国际标准化组织）：
  * IEEE（电气电子工程师协会）
  * ANSI（美国国家标准研究所）
  * EIA（电子工业协会）
* IAB（Internet体系结构委员会）
  * IETF：RFC标准
  * IRTF
  * ICANN：IP地址和自治域号码分配、域名系统和根域名服务器管理
* W3C
* RFC(Request For Comments)任何人都可以提交，使用数字命名：
  * 因特网草案；
  * 提议标准；
  * 草案标准；
  * 因特网标准。

## Chap2 物理层
### 2.1 数据通信的理论基础
* 傅里叶分析：任何信号都可以看成由不同频率成分组成。
  * 方波的离散函数是连续的
* 带宽是传输介质的物理特性。
* 有限的带宽限制了数据的传输速率。
* 带宽表示：
  * **模拟信道：Hz**
  * **数字信道：bps**
#### 2.1.3 信道的最大数据速率
* 无噪声有限带宽信道的最大数据传输率：**2Blog2V (bps)**
  * 任意信号通过一个**带宽为B**的低通滤波器，则**每秒采样2B次**就能完整地重现该信号，**信号电平包括Ｖ个离散等级**
* 香农公式：
  * **信噪比 = 10log10(S/N) (db)**
  * 最大数据传输率 **（信道容量） = Blog2(1 + S/N) (bps)**

### 2.2 有导向传输介质
* 物理传递磁介质：数据率高，延迟大
#### 2.3 双绞线
* 模拟/数字
* 不同电线产生的干扰相互抵消，抵抗共模干扰
#### 2.3 同轴电缆
* 传输特性比双绞线好
* 75Ω-Analog-300~400MHz
* 50Ω-Digital
#### 2.4 电力线
#### 2.5 光纤
* 纤芯、包层、护套
* 通过光信号的有无表示0/1
* 不受电磁干扰
* 高带宽低衰减
* 0.85um,1.30um,1.55um三个窗口 
### 2.5 数字调制和多路复用
* 基带传输
  * 数据比特直接转换成信号
  * 基带：0-到最大值之间的全部频率，是原始信号所固有的频带。
  * 基带传输：在传输时直接使用基带信号。不用调制
  * 通带传输：把基带信号搬移到其他频带传输，通常叫调制
* 通带传输
  * 调制：
* 多路复用
  * 频分复用FDM；时分复用TDM；码分复用CDM。

### 2.6 公共电话交换网络
#### 2.6.5 交换
* PSTN-电路交换
* Internet-分组交换
* 数据报&虚电路

## Chap3 数据链路层
### 3.1 数据链路层中的设计问题
#### 成帧
* 字符计数法
* 带字节填充的分解符法
* 带位填充的分界标志法
* 差错控制（定时器），流量控制（接收方确认）

### 3.3 停等协议
### 3.4 滑动窗口
#### 1位滑动窗口协议
#### 退回N协议

#### 选择重传协议
* 窗口大小为 (MAX_SEQ + 1) / 2, MAX_SEQ = 2^n - 1
* 即2^(n-1), 为退回N协议等的一半


## Chap 4 介质访问控制
* 介质访问控制协议(MAC)是数据链路层协议的一部分。

### 4.2 多路访问协议
#### ALOHA协议
* **纯ALOHA**：
  * **直接发送**，**发送后监听是否冲突**。若冲突则延后随机时间重发。
  * 效率低，信道利用率低，冲突几率大。G=0.5时，吞吐率S最大，信道利用率=**0.184**
* **分槽ALOHA**：
  * 把信道时间分成离散时间槽，槽长为一个帧所需的发送时间。只有在槽开始时可以发送。冲突后延迟随机个时间槽再发送。信道利用率=**0.368**（必须全局时间同步）
#### 载波监听多路访问协议CSMA
* 使用条件：**传输延迟 << 发送延迟**--局域网传输距离小时有效。
* **载波监听（发送前监听）**
* **1-坚持性CSMA**
  * 监听至信道空闲，发送；发送后冲突，随机延迟重发。
  * 减少空闲时间，增加冲突概率。
* **非坚持型CSMA**
  * 监听发现信道忙，随机等待一段时间后重新监听
  * 减少冲突概率，增加了空闲时间，数据发送延迟增大
  * 效率比**1-坚持性CSMA**高，延迟比**1-坚持性CSMA**大
* **p-坚持性CSMA**
  * **适用于分槽信道**
  * 监听，发现空闲，以概率p发送数据，概率q=1-p延迟到下一时槽。
  * 监听，发现忙，等待下一时槽，重新开始。
* **带冲突检测的CSMA-CSMA/CD**
  * 发送期间**边发边监听**，**发现冲突，立刻终止**，并瞬间**发一个干扰**，使所有站点知道发生冲突。
#### 无冲突协议（不考）
* N个站，竞争周期分位N个时槽，有帧要发送时在对应的时槽发1
* 竞争周期过后按站号顺序发送
* 发送完成后进入下一个竞争周期。
* 效率
  * 轻负载：d/(N + d)数据帧由d个时间单位组成
  * 重负载：d/(d + 1)
* 缺点：不公平，序号小服务好；每个站有1比特开销。

#### 无线局域网协议
* 有线网络同时只能有一个发送。无线网络的多个接受方只要都在对方范围外就可同时发送。
* **差异：**可能无法给所有站发送帧，也无法接受所有站发送的帧。**冲突发生在接收方**
* **隐藏站**：竞争者离得太远，无法检测到潜在竞争对手。
* **暴露站**：发送站检测到别人的传输过程而影响发送（因为这个传输过程并不会影响接收站，发送站本应正常发送）
* A-->B. A send RTS(包含将要发送的数据帧长度). B send CTS(包含数据帧长度).A received, start transmiting.
* 发送方在期待时间内未听到CTS则重发RTS

### 4.3 以太网协议
* 经典以太网, CSMA/CD, 3-10Mbps
* 交换式以太网, 100/1000/10000Mbps
* IEEE定义了采用1-坚持型CSMA/CD技术的802.3局域网标准，与以太网协议略有差别。
#### 经典以太网
* **曼彻斯特编码**，同轴电缆作为总线
* 以太网帧标准

|8    |6       |6    |2    |0-1500|0-46 |4     |
| --- | ---    | --- | --- | ---  | --- | ---  |
|前导码|目的地址|源地址|类型 |数据  |PAD  |校验和 |

* 地址为MAC地址，前三字节为厂商代码，后三字节每个网卡不同
* **以太网地址全1表示广播**
* 类型>600H为以太网协议，<600H为IEEE802.3
* 数据段长度46-1500
* **最短帧长**
* 第一比特到电缆最远端时间 = t
* 帧发送时间>=2t
* 网速提高：增大最短帧长/减少站间距离
* 二进制指数后退算法BEB：
  * 发生i次冲突后，在0-2^i -1间选一个等待时槽数，开始重传。
#### 交换式以太网
* Hubs集线器，把所有端口集中到一个CSMA/CD冲突域
* Switches交换机隔离每个端口为一个独立冲突域。

#### 快速以太网
* 802.3u, Fast Ethernet 10-100Mbps
* 8B/6T--8位二进制映射到6位三进制上

#### 千兆以太网
* 802.3z, 100-1000Mbps
* 所有配置都是点到点
* 全双工模式：交换机连接所有计算机，不用CSMA/CD
* 半双工模式：计算机连接集线器，使用CSMA/CD
  * 荷载扩充，帧串

### 4.8 数据链路层交换
* 网桥：工作在数据链路层的一种互联设备（看到的是帧），在互联的LAN之间实现帧的储存和转发。
#### 网桥的使用
* 可以将高负载的LAN分割成几个LAN以减轻负担
* 隔离负载，防止故障损害全网
* 安全保密

#### 学习网桥
* 相当于以太网交换机，接受所有和它相连的LAN上传送帧。
* 一开始地址/端口表为空。采用扩散算法转发帧。
* 通过源地址记录地址与端口对应关系。
* 地址/端口表不断更新，定时检查删除一段时间内未更新的项。
  * 目的LAN与源LAN相同，则丢弃帧；
  * 目的LAN与源LAN不同，则转发帧；
  * 目的LAN未知，则洪泛帧，并逆向学习。

#### 生成树网桥
* 解决回路问题
* 构造生成树
  1. 每个桥广播自己的序列号，号最小的桥变成生成树的根；
  2. 每个网桥计算自己到根的最短路径，构造出生成树，使得每个LAN和桥到根的路径最短；
  3. 当某个LAN或网桥发生故障时，要重新计算生成树；
  4. 生成树构造完后，算法继续执行以便自动发现拓扑结构变化，更新生成树。

#### 中继器\集线器\网桥\交换机\路由器\网关
* 物理层：中继器\集线器
* 数据链路层：网桥\交换机
* 网络层：路由器
* 传输层：网关

#### 虚拟局域网
* **将逻辑拓扑结构与物理拓扑结构脱离**
* 在网桥或者交换机中建立配置表，指明了通过那些端口可以访问那些VLAN，一个端口可以被标记上多种VLAN颜色。
* 基于端口的划分、MAC地址、第三层协议或者IP地址的划分
* IEEE 802.1Q：在帧头添加VLAN标签
* 在转发该帧过程中第一个支持VLAN的网桥或者交换机加入VLAN标签，下行路径中最后一个支持VLAN的网桥或者交换机将这些VLAN标签去掉。

