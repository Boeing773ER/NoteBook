# 系统结构复习
* 减少客观题，增加大题。
* 单选10'+填空10'+大题80'
* 全部作业都要会做，不会出作业原题
* 重新做一遍作业
* 剩下的客观题，PPT为主
## Chap1 系统结构基本概念
系统结构与组成实现的关系，什么是透明性，分类的几种方式，系统设计的三原则，定量定性程序局部性，系统程序结构，计算机不同的程序分类
### 1.2 计算机系统结构
#### 1.2.1 系统结构基本概念
* **系统结构**：从程序设计者的角度所看到的系统的属性，即概念性结构和功能特性。
* **计算机系统结构**：指**机器语言程序**的设计者或是**编译程序**设计者所看到的计算机系统的**概念性结构与功能特性**。 
* **透明性**：一种本来存在，有差异的事物和属性，从某种角度上看又好像不存在的现象，被称为是“透明性”。Exp：高级语言程序员看不到不同机器的差异性。
#### 1.2.2 计算机系统结构、组成与实现
* 计算机**系统结构**：**机器语言级**的程序员所了解的**计算机的属性**，即**外特性**。
  * 数据表示、寄存器定义、指令系统、中断系统、存储系统、I/O、及其工作状态、信息保护。
* 计算机**组成**：计算机**系统结构**的**逻辑实现**。
  * 数据通路宽度、专用部件的设置、各功能部件、控制机构组成方法、缓冲技术……
* 计算机**实现**：计算机**组成**的**物理实现**。
  * 逻辑设计的物理实现
* 计算机系统的结构、组成、实现**相互依赖相互影响**。
* 指令系统--结构，乘法指令--组成，主存系统--实现。
#### 1.2.3 系统机构分类
1. **弗林分类法(FLYNN)**：
  * **指令流**(指令传送序列)
  * **数据流**(数据传送、加工序列)
  * **多倍性**(系统瓶颈部件上同一阶段执行的指令或数据最大可能个数)。
* 单指令流，单数据流--**SISD**(传统顺序处理机)、
* 单指令流，多数据流--**SIMD**(阵列机，并行处理机)
* 多指令流，单数据流--**MISD**(RISC机，向量机)
* 多指令流，多数据流--**MIMD**(多处理机系统)
2. 冯氏分类法
   * 最大并行度：计算机单位时间内能处理的最大二进制位数。
   * 一个字中同时处理二进制的位数&一个位片或功能部件中能同时处理的字数
3. 汉德勒法
   * 硬件设备结构的并行级和流水线的程度分类。
   * 程序控制部件个数，算数逻辑运算部件，基本逻辑线路套数。
### 1.3 计算机系统设计
#### 1.3.1 设计原则
##### 1. 加速使用频率高的部件--提高整个计算机性能
##### 2. Amdahl定律
* **Amdahl定律**：衡量系统性能提升的指标--**加速比**
* **加速比** = 采用改进措施**后的性能** / 采用改进措施**前的性能**
* **加速比**($S_p$) = 采用改进措施**前的耗时** ($T_e$)/ 采用改进措施**后的耗时**($T_0$)
* $f_e$：可改进部分在原系统计算时间中占比，<1;
* $r_e$：性能提高倍数，可改进部分的改进前耗时 / 改进后耗时，>1。
* $f_e/r_e$：改进后改进部分时间 / 改进前整个任务时间
$$
S_p = T_e/T_0
\\T_0 = T_e(1-f_e + f_e/r_e)
\\S_p = \frac{1}{(1-f_e + f_e/r_e)}
\\ \lim_{r_e \to \inf}S_p = \frac{1}{1-f_e}
$$
* 为获取较高的加速比，功能性增强的部分需要**占有较大的比例**($f_e$尽量大)。
##### 3. 程序访问局部性原理
* 局部性:程序往往重复使用**刚使用过的数据和指令**。
    * 时间局部性：近期被访问的代码，不就将再次被访问
    * 空间局部性：地指上相邻的代码可能被连续访问。
#### 1.3.2 设计方法
* 软硬件**功能的分配**，考虑：功能要求、性能要求、成本要求。
* **设计方法**：自下而上、自上而下(专用机)、**由中间开始**(最好)
#### 1.3.3 设计步骤
* 需求分析、需求说明、概念性设计、具体设计、优化和评价
* 获得尽可能高的性能价格比。
### 1.4 计算机性能评价
* 计算机性能以及系统评价的目标都指：**系统速度的性能**(通常用**响应时间**衡量)
* **响应时间**：任务送入计算机--得到结果。受磁盘速度，内存速度，CPU运算速度等影响。
#### 1.4.1 CPU性能
* $T_{CPU}$：CPU执行用户程序所用时间
* $I_N$：INS number
* CPI：每条指令所需**平均周期数**= 总周期数 / 总指令数
* $T_C$：时钟周期
$$
T_{CPU} = I_N\times CPI\times T_C
$$
#### 1.4.2 MIPS & MFLOPS
* MIPS：每秒执行指令条数（百万）
$$
MIPS = \frac{指令总数}{执行时间 \times 10^6} = \frac{时钟频率}{CPI\times 10^6} 
$$
* MFLOPS：每秒浮点操作次数（百万）
$$
MFLOPS = \frac{浮点操作次数}{执行时间\times 10^6}
$$
### 1.5 计算机系统层次结构
1. 运算器中心，除了完成运算以外，机器内部的数据传送都经过运算器，控制器集中控制。
2. 存储器是字长固定的、顺序线性编址的一维结构。 
3. 程序存储，指令和数据都存放在存储器中。 
4. 指令在存储器中按其执行顺序存放，由一个顺序控制器指定即将被执行的指令地址。
5. 指令由操作码和地址码组成。 
6. 数据以二进制表示。  
* 改进：
1. 数据类型增加
2. 指令种类、寻址方式增加
3. 以存储器为中心
4. 处理器采用新技术——堆栈、流水等


## Chap2 指令系统
 大题：霍夫曼编码相关，概念比较零碎，RISC&CISC
### 2.1 引言
* **指令系统**：又称**指令集**，计算机体系结构设计的核心，是**计算机软、硬件接口**，是机器语言汇编语言编写程序的用户看到的计算机基本属性。
* 指令系统设计确定指令格式、数据类型、操作功能及操作数访问方式。
#### 2.1.1 指令系统设计要求
* **软件兼容性**：继承软件资产，保证**向后兼容**(旧的)和**向上兼容**(新的)
* 可扩性：保留一定余量的操作码空间，为以后扩展准备。
* 指令码高密度性：对频率高的指令串进行优化，设计新指令代替，提高指令码密度。
#### 2.1.2 CISC & RISC
1. **CISC**复杂指令集计算机
   * 执行通过**微程序控制技术**
   * 控制器复杂，占用大量CPU芯片面积，有些复杂指令很少用
   * 执行效率不高
   * 指令系统与软件间语义差别大，设计繁重。
* **缺点**：指令系统庞大、硬件复杂、执行速度低、编译程序复杂，长、部分指令使用效率低。
2. **RISC**精简指令系统计算机
   * **减少**指令**总数**和**简化**指令的**功能**来**降低硬件设计的复杂程度**，提高指令执行速度，使指令简单，有效可行。
### 2.2 数据类型和数据表示
#### 2.2.1 数据类型
* 三类：用户定义的数据、系统数据、指令数据(指令系统能处理的数据)
* **数据类型**：指一组数据值的集合，以及可作用于这个集合上的操作集
  * 分类：基本数据类型、结构数据类型、抽象数据类型和访问指针。
#### 2.2.2 基本数据表示
* **数据表示**：在计算机中能**由硬件直接辨认**，**指令系统直接调用**的数据类型。
* **数据结构**：结构化数据的组织方式，通过软件映像变换成机器中所具有的各种数据表示实现。
#### 2.2.3 自定义数据表示
* **目的**：缩短机器语言同高级语言对数据属性说明间的语义差异
* **自定义数据表示**：由数据本身来表明数据类型，使计算机内的数据具有自定义能力。
* **分类**：带标志符的数据表示、数据描述符。
  * **带符号的数据表示**：描述**简单**数据，和数据值**相连**，储存在**同一存储单元**内
    * **优点**：简化了指令系统、容易检出程序编制中的错误、简化了编译程序、支持数据库系统、简化了程序设计、便于软件测试，支持应用开发
    * **缺点**：数据字长增加、降低了指令的微观执行速度、与其他计算机的兼容性差，硬件复杂。
  * **数据描述符**：描述**复杂**和多维数据，描述了所要访问数据的特性，和数据字**分开存储**，**增加一级以上寻址**。是程序的一部分不是数据的一部分。数据字本身是带标志符数据表示。
### 2.3 指令系统设计原理
#### 2.3.1 指令系统中指令编码方法
1. **正交**：每个分段相互独立。优点：适用于流水机，微程序控制数量减少。
2. **整体**：各个分段译码时相互有关，操作码与操作数和地址分界线不清晰。
   * 优点：可以缩短使用频度高的指令长度，频率低的指令长，节省储存空间；
   * 缺点：用微程序控制时微程序数量多，需要有较大的微程序存储器。
3. **混合**：结合以上两点。
#### 2.3.2 指令系统及结构的分类
* 基本思想：计算机系统的一些基本操作应由硬件实现还是软件实现；某些复杂操作是由一条还是一系列指令实现。
* 分类：
  * 每条指令中显示指明操作数个数
  * 操作数的类型及长度的确定
  * 数据类型和数据表示
  * 操作数的位置--堆栈、寄存器、存储器。
#### 2.3.3 寻址技术
寻址技术指指令**按什么方式寻找**所需的操作数或信息。影响主存规模、速度及存取方法。寻址方法**对程序员透明**。
* 访问方式：按地址访问(串行)、按内容访问(并行，小容量)。
* 编址方式：
  1. **统一编址**：各部件统一编成一个从0开始的一维线性地址空间，对不同部件的访问反映在对这个空间中不同地址的访问。**优**：有利简化指令系统；**缺**：使地址形成更复杂。
  2. **局部编址**：每个部件各自从0开始单独编码，形成多个一维线性地址空间。**优**：指令字长较短，地质形成简单，主存编址范围大；**缺**：指令中需要有对每类存储信息加以区分的标志或使用约定。
  3. **隐含编址**：不进行地址计算，隐含在操作码中。多数**事先约定好**编址方式进行隐式寻址。**缺**:导致指令系统设计缺乏规范。
* **程序定位方式**：指令和数据中的逻辑地址转变成主存的物理地址的过程。
  1. 直接定位：直接用物理地址变成(一般不用)
  2. 静态地址：专门的装入程序完成，装入后不可变。**优**：实现简单，不用增加硬件地址。**缺**：不灵活，内存利用率不高，无法实现共享。
  3. 动态定位：主存起始地址装入对应寄存器，指令地址不需全部修改。**优**：执行时由硬件形成物理地址，内存利用率高，多用户可以实现共享，支持实现虚拟存储器。**缺**：需要硬件支持，算法复杂。
#### 2.3.4 指令格式的优化
* 指令的优化通过**操作码**优化和**地址码**优化进行。
* **操作码的优化：哈夫曼压缩**
* **操作码的信息源熵**：信息源所包含的平均最短信息量。
* $P_i$:第i个信息源的频度。
$$
H = - \Sigma P_i \log_2P_i
\\ 信息冗余量 = \frac{1-H}{操作码平均长度}
$$
* 霍夫曼编码定长扩展：2/4/6，每次留最后一组用于下一长度的扩展
* 15/15/15编码法：几类数量一样。
  * 0000 ~ 1110
  * 1111 0000 ~ 1111 1110
  * 1111 1111 0000 ~ 1111 1111 1110
* 8/64/512编码法：高频少，低频多。
  * 0000 ~ 0111 :8
  * 1000 0000 ~ 1111 0111 :8 * 8
  * 1111 1000 0000 ~ 1111 1111 0111 :8 * 8 * 8
* 地址码的优化：
    1. 操作数地址码长度可在很宽的范围内变化，可与变长操作码合成定长指令；
    2. 改变指令字中的**地址数**和**地址码**的**长度**，使单、双、三地址都可以在指令中使用；
    3. 若操作数存在寄存器内，或经寄存器间接寻址，则指令地址码的宽度能指明寄存器号即可；
    4. 设法利用空白处存放立即操作数或常数。
### 2.4 RISC计算机
#### 2.4.1 RISC计算机的设计原理
1. **起源**：
   1. **二八定律**
   2. 系统设计中硬件和软件间的折中。
   3. VLSI工艺技术发展。
2. **设计原则**：
   1. 选择**使用频率高**的指令，增加少量支持操作系统和高级语言实现及其他功能的有用指令。**寻址方式**取最基本的一两种。使指令**条数少**，**格式简单**，**长度相同**。
   2. 提高处理速度，使用**流水技术**（使每条指令可以在一个周期内完成）。大部分指令操作在**寄存器**间进行，采用硬件逻辑控制实现操作，只有少量使用微程序实现。
   3. **简化编译**工作，一个周期完成一条指令操作，编译器易于调整指令流。
3. **RISC的CPI**：

|类型|$I_N$|CPI|$T_c(ns)$|
|---|---|---|---|
|CISC|1|2~15|33~5|
|RISC|1.3~1.4|1.1~1.4|10~2|
   * RISC结构的$T_{cpu}$值远小于CISC结构
     * RISC通过减少CPI值简化结构来减少$T_{cpu}$
     * CISC通过减少$I_N$来减少$T_{cpu}$
#### 2.4.2 RISC主要技术
1. **流水小结构和调度指令**：RISC主要特点之一是充分提高流水线效率
2. **寄存器窗口重叠**：RISC芯片上有大量通用寄存器
   * **寄存器窗口技术**：寄存器分成很多小组，每个过程分配一个小组。发生过程调用时，把CPU转换到不同的小组使用，无需保存和恢复的操作。此小组称为寄存器窗口。相邻的窗口间有部分重叠，便于调用参数传送。
   * **RISC有八个寄存器窗口**：窗口转换通过改变硬件指针实现。超过八个过程调用时，将一个窗口内容传送到内存。
 * **优点**：显著减少过程调用和返回执行时间、执行的指令条数和访问存储器的次数。
3. **优化编译技术**
   1. 如何最佳分配寄存器堆中的寄存器，使数据有效地减少对存储器的访问
   2. 在保持原来语义的基础上对指令序列重新排序和调度，进行并行性的开发。
* **优点**：
  * RISC指令系统条数少，简单对称，减轻编译程序负担；
  * RISC寻址方式简单，只有LOAD和STORE指令访问存储器。其它操作均在通用寄存器中进行，简化寻址方式和访存操作；
  * 大多数指令在一个周期内完成，为优化编译器进行调整指令流序列，减少相关，提高并行度带来了方便。


## Chap3 储存系统
* CACHE大题--15'


## Chap4 流水线技术
* 三个作业大题都考
* 先写后读相关：


## Chap5 并行处理机和多处理机




